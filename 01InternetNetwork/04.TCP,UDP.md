## TCP( TCP 프로토콜 )

### 인터넷 프로토콜 스택의 4 계층
    
> 애플리케이션 계층 -  __HTTP , FTP__
> 
> 전송 계층 - __TCP , UDP__
> 
> 인터넷 계층 - IP
> 
> 네트워크 인터페이스 계층
    
***

이 IP 위에 TCP 계층을 올려서 IP 를 보완해준다고 보면 된다.

### 프로토콜 계층

> #### 애플리케이션  
> ( 웹 브라우저, 네트워크 게임, 채팅 프로그램 )
>
>>__SOCKET 라이브러리__ 
>>
>> socket 라이브러리를 통해 데이터를 받으면
>> 해당 데이터를 OS 계층에 전달한다

> #### OS
>> 
>>> __TCP__
>>> 그러면 받은 데이터를 TCP 에 관련된 데이터로 한번 감싸고,
>>>
>>> IP 계층으로 보낸다
>>
>>> __UDP__
> 
>> __IP__( Internet Protocol )
>>
>> 다시, 해당 데이터를 IP 에 관련된 데이터로 한번 감싸고,
>> IP 패킷을 맨든다

> #### 네트워크 인터페이스
>> LAN 드라이버
>>
>> LAN 장비
>> 그리고 이제, 네트워크 인터페이스( LAN 카드 )를 통해 나갈때,
>> __Ethernet frame__ 에 한번더 감싸서 서버로 나간다 
>>
>> ( __Ethernet frame__ : MAC 주소등 물리적인 주소 포함 )

***

### IP 패킷 정보

> __IP 패킷__
>
> 출발지 IP, 목적지 IP , 기타...
>
> ( 패킷은.. package 및 bucket 의 합성어 )
>> __TCP 세그먼트__
>>
>> 출발지 PORT , 목적지 PORT , 전송제어 , 순서 , 검증정보...
>>
>> ( IP 만으로 해결이 안됬던 순서 제어문제등이 해결됨 )
>>>__전송 데이터__
>>>
>>> 이제 실제 전송 데이터를 보내게 된다

***

### TCP 특징
__전송 제어 프로토콜( Transmission Control Protocol )__

따라서, 이러한 순서를 가지고 보내기 때문에 TCP 는 전송에 대한 정보들을 해결한다

> - 연결 지향 - TCP 3 way handshake( 가상 연결 )
> 
>  ( 상대랑 나랑 연결이 되어있는지, 되어있지 않는지를 확인 )
> - 데이터 전달 보증
> 
>  ( 데이터가 누락되었는지 , 받앋는지 보증 )
> - 순서 보장
> 

> 신뢰할 수 있는 프로토콜
> 현재는 대부분 애플리케이션에서 TCP 사용

***

### TCP 3 way handshake( 연결 지향 )

일단 TCP IP 프로토콜로 연결을 하면, 

> 1. 클라이언트에서 서버로 SYN 메시지를 보낸다.
>
> 2. 그러면 서버에서  SYN + ACK 메시지를 보내고
> 
> 3. 클라이언트에서 다시 ACK 를 보낸다.

이렇게 3번 통신을 하면, 클라이언트와, 서버 모두 서로의 데이터 및 연결을
신뢰할 수 있다

그 후 **데이터를 전송** 한다
( 요새는 최적화가 되어, 3. ACK 를 할때 **데이터** 또한 함께 전송한다 )

---

그런데, 이게 진짜 물리적으로 연결된게 아니고, 개념적으로 연결되었다는 것이다

( 그냥 서로 , SYN 보내고 , ACK 받고등 논리적으로 연결이 되었다라는 것 - 보장된 것이 아님 )

---

### 데이터 전달 보증( TCP 에서... )

데이터를 전송하게 되면, 서버에서 데이터를 잘받았다고 응답을 보내준다

---

### 순서 보장

1. 패킷을 1, 2, 3 순서로 전송

2. 패킷이 1, 3, 2 순서로 도착

3. 다버리고, 패킷 2번부터 요청

--> 물론 내부적으로 최적화가 이루어져 로직이 다를 수 있다

--> 그러나, 기본적으로는 잘못보낸 부분부터 다시 요청

---

이런 것들은 그냥 가능한게아니라, TCP 안에는 

***전송 제어 정보, 순서 정보 , 검증 정보***등이 포함이 되어있다.

따라서, ***TCP 는 신뢰할 수 있는 프로토콜*** 이다

## UDP 특징
***사용자 데이터그램 프로토콜( User Datagram Protocol )***

- 하얀 도화지에 비유( 기능이 거의 없음 )
- 연결 지향 - TCP 3 way handshake [ __X__ ]
- 데이터 전달 보증 [ __X__ ]
- 순서 보장 [ __X__ ]
- 데이터 전달 및 순서가 보장되지 않지만, 단순하고 빠르다
- 정리
  - IP 와 거의 같다. +PORT +체크섬 정도만 추가
  - 애플리케이션에서 추가 작업이 필요함

그냥 IP 와 똑같은데, IP 에 PORT , 체크섬 정도가 추가된다

( 물론 TCP 도 PORT 를 가지고 있다 )

( __체크섬__ : 해당 데이터가 맞는지 검증 )

---

#### PORT
하나의 IP 에서 여러개의 애플리케이션이 작동한다면, 
해당 애플리케이션에대한 패킷을 구분할 수 있도록 해준다

> 예) PC 하나에 IP 하나 할당한다
> 
> 그런데, 컴퓨터 한대로, 네트워크 게임 및 인터넷 스트리밍을 하고있다고 가정할때,
> 
> 해당 컴퓨터 IP 로 여러 패킷이 온다면 어떤 패킷이 네트워크 게임용인지, 
> 인터넷 스트리밍용인지 구분할 때 사용하는 것이 PORT 이다

---

그렇다면 왜 UDP 를 쓸까? TCP 가 더 좋지 않을까 하는 의문이 남아있다
그런데, UDP 의 장점이 있다

- TCP 는 다좋지만 __3 way handshake__ 를 하게되면, 시간이 걸린다
- 연결, 전송 확인, 데이터양 ,전송 속도등을 더 빠르게 만들기 힘들다
- 즉, 더 ***최적화***를 할 수 없다

***TCP 는 더이상 손을 못댄다***
( 인터넷이 TCP 를 기반으로 사용하고 있기 때문에... )

---

그런데, 만약 더 최적화 할 수 있다하면, TCP 를 놔두고,
UDP( 애플리케이션 레벨 )에서 만들어 내면 된다

( 하얀 백지이기 때문에... )

최근에는 UDP 가 뜨고 있는 추세...