## 프록시 캐시

---

### 원 서버 직접 접근
#### origin 서버

> **한국에 있는 클라이언트들**
> 
>> 웹 브라우저1
> 
>> 웹 브라우저2
> 
>> 웹 브라우저3



( _**500ms( 0.5 초 )**_ ) -->

> **미국에 있는 원 서버**
>
> ( 원소스가 있는 서버 ) 
> 
>> 서버

- 모든 사용자들이 이미지 하나 다운받을때 0.5초 씩 기다려야 한다

---

### 프록시 캐시 도입
#### 첫 번째 요청

> **한국에 있는 클라이언트들**
>
>> 웹 브라우저1
>
>> 웹 브라우저2
>
>> 웹 브라우저3

( _**100ms( 0.1 초 )**_ ) -->

> **프록시 캐시 서버**
>
> ( 한국 어딘가... )
>
>> 서버

( _**400ms( 0.5 초 )**_ ) -->

> **미국에 있는 원 서버**
>
> ( 원소스가 있는 서버 )
>
>> 서버

- 보통 CDN 서비스라고 부른다


- DNS 를 조작해서 원서버에 요청하면, 프록시 서버를 거쳐서 오도록한다


- 한국 어딘가 있는 서버기 때문에 빠르게 응답을 받는다
- ( 유튜브를 빠르게 볼 수 있는 이유 )
- 마찬가지로 사람들이 잘 안보는 유튜브 외국컨텐츠를 보면 다운로드가 느리다

---

### 프록시 캐시 도입

> **한국에 있는 클라이언트들**
>
>> 웹 브라우저1
>>
>> private 캐시
>
>> 웹 브라우저2
>
>> 웹 브라우저3

( _**100ms( 0.1 초 )**_ ) -->

> **프록시 캐시 서버**
>
> ( 한국 어딘가... )
>
>> 서버
>> 
>> public 캐시

( _**400ms( 0.5 초 )**_ ) -->

> **미국에 있는 원 서버**
>
> ( 원소스가 있는 서버 )
>
>> 서버

- 보통 캐시가 최초의 요청은 느리다


- 그러나 한번 원 서버에서 프록시 캐시서버가 다운로드 받아 두면 두번째 요청부터는 빠르게 처리할 수 있다


- public 캐시는 프록시 서버에서 공용으로 사용되는 캐시,
- private 캐시는 웹브라우저나 로컬에 저장되는 캐시

---

### Cache-Control
#### 캐시 지시어( directives ) - 기타

- **Cache-Control: public**
  - 응답이 public 캐시에 저장되어도 됨


- **Cache-Control : private**
  - 응답이 해당 사용자만을 위한 것임, private 캐시에 저장해야 함( 기본 값 )
  - 프록시 서버에 저장되면 안됨
    - 로그인 정보등이 프록시서버에 캐시되면 큰일남
    - 공용이미지는 괜차늠


- **Cache-Control : s-maxage**
  - 프록시 캐시에만 적용되는 max-age


- **Age: 60**( HTTP 헤더 )
  - 오리진 서버에서 응답 후 프록시 캐시내에 머문 시간( 초 )
  
---

원서버 : 원래 자원과 리소스가 있는 그 서버!!